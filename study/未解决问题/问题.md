
   ## 问题：阻塞/非阻塞read、write、与阻塞/非阻塞IO、异步/同步IO分别是什么???  20210903记录问题，后面要总结出来！！！！


   Unix网络编程卷1，*15章*
   Unix环境高级编程 *3章*


   ## 断开连接的时候，epoll返回什么、select和poll呢？

   ## 标准库跟平台有关吗?Glibc、VS等是不同的？
   
   ## 内存分配时的线程安全性？
   Linux多线程服务端编程（*4.2节*）：
   C++的标准库容器和std::string都不是线程安全的，std::allocator是线程安全的

   ## 什么时候使用unordered_map？什么时候使用map？（哈希和树的选择）

   ## 排行榜实现

   ## 什么是自旋锁

   ## 各个协议的头部

   ## 全双工与半双工
   TCP是全双工的，UDP是半双工
   MySql的客户端和服务端通信协议是半双工的，是什么协议？



   ## 学习muduo中双缓冲区技术2021/11/15

   ## web服务器中连接是长链接还是短连接？长连接短连接分别什么时候断开？哪一端断开？

   ## 一个TCP连接占用多少内存？
<https://zhuanlan.zhihu.com/p/25241630>
经sysctl -a | grep tcp_.mem得：
net.ipv4.tcp_rmem = 4096        87380   6291456  //接受缓冲区，4KB
net.ipv4.tcp_wmem = 4096        16384   4194304  //发送缓冲区，4KB
TCP协议控制块（内核数据结构）占用2KB,因此一条TCP连接占用10KB内存，
但这种说法不正确，原因在于：
(1)TCP连接建立时，并不会立即分配接受缓冲区和发送缓冲区,缓冲区并不是一直存在,对于接收缓冲区，当套接字可读且未读时，缓冲区占用内存，但是当读取之后，数据清空，便不再占用内存，等再次收到数据时，在分配内存存放数据；而对于发送缓冲区，当发送完到接受到ack之前，数据一直在缓冲区内存中，收到ack之后，将数据清空；
(2)每个TCP套接字对象占用2KB内存，但套接字本身是个文件，因此它会占用进程的文件描述符表中的一项，同时会占用内核的文件表的一项；一个套接字所涉及的内存大约3KB
所以，一个TCP连接，最少占用约3KB，最多约11KB


   ## 一台linux服务器最多能支持多少个TCP连接？
   一个TCP连接由一个四元组确定，在服务器端，连接的目的端IP和端口是固定的，源端IP和端口是任意的，所以理论上有2的32次方（IP）*2的16次方（port）个连接；
   但实际上，会受到系统资源的限制：
   （1）首先是可打开文件的数量：
   linux一切皆文件，每一个TCP连接，对应有一个套接字文件，linux在系统级、用户级、进程级限制了可打开的文件的最大数量
   1. 系统级：当前系统可以打开的文件数量
   2. 用户级：用户可以打开的文件数量
   3. 进程级：一个进程可以打开的文件数量

   （2）每一条TCP连接对应内核中的一个数据结构，将占用内存资源，一条空TCP连接大约占用3.3KB,如果发送接受数据，还会为其分配发送、接受缓冲区，这将进一步增大内存资源的占用


   ## 一个进程能开启多少个线程？
   受到虚拟地址空间和系统参数的限制
   （1）每个线程有一个私有的栈空间，这将占用一部分用户态虚拟地址空间，如果是32为系统，虚拟地址空间4G,用户态3G,
   linux中每个线程的栈空间默认大小是8M，通过ulimit -s 查看；
   那么3G/8M = 484,再出去进程代码段、数据段所占用的空间，大约480个线程；
   除此之外，线程还有一些相关的内核数据结构，这将占用一部分内存

   而对于64位系统，用户态和内核态均为128T，所以理论上线程数是一个很大的值
   但是线程数又会收到系统参数的影响：

   （2）影响线程数的系统参数：
   1. 系统所支持的最大线程数,系统存在线程数的上限：/proc/sys/kernel/thread-max,服务器上的默认值是15606；
   2. PID号的限制，每个线程有一个标识符，系统存在一个上限：/proc/sys/kernel/pid-max,服务器上默认值是32768
   3. 一个进程所能拥有的虚拟内存区域的数量：每个线程有一个栈，在进程的虚拟地址空间中表示为一个虚拟内存区域vm_area_struct;其上限是：/proc/sys/vm/max_map_count,服务器上默认值是65530



## 文件描述符的执行时关闭标志（）
当一个文件的执行时关闭标志被设置，则，当fork创建一个子进程后，在调用exec后，新进程中将关闭该描述符，否则新进程将保持打开这个文件描述符（而它与父进程共享一个文件表项）

在执行fork后，子进程的文件描述符表与父进程的文件描述符表相同，而且指向同样的文件表项



