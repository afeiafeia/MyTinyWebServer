


<https://www.cnblogs.com/Commence/p/5785912.html>

## 直接使用物理地址的缺点
如果进程可以直接访问所有物理地址，则进程与进程的地址空间不是隔离的，一个进程就可能会改写其它进程地址空间中的数据；
即使对每一个进程规定好物理地址范围，也可能由于程序的bug，造成对不属于自己的地址空间的访问，另外，编写程序时，如果提前确定好每个程序运行时所使用的物理地址空间，后期随着程序数量的增加，管理很麻烦
另外，如果由操作系统自行分配，也存在内存碎片的问题（随着进程的换进换出，地址空间产生过多小块区域，空闲但是也无法提供给进程使用）；

## 虚拟地址
虚拟地址将进程的地址空间隔离开，进程访问虚拟地址空间，操作系统通过MMU将其映射到物理地址空间，在映射之前进行地址有效性、访问权限等检查，防止非法访问

## 操作系统管理虚拟地址和物理地址的方式

### 分段
将虚拟地址空间分为几个段区，每个段是一块连续空间，一般是分为代码段、数据段、堆、栈、动态映射区
缺点：
1. 程序载入的时候以一个段为单位，可能造成内部碎片，使得虽然有空闲控件，但放不下一个新进程的一个段，导致新程序不能加载；
2. 当出现内部碎片的时候，可通过内存交换解决，将暂时未在使用的一个段换出到磁盘上的交换区，但由于段区比较大，那频繁的换入换出造成频繁的磁盘IO，必然影响性能
 
### 分页
概念：将虚拟地址空间、物理地址空间划分成若干相同尺寸的区域，每一个区域称为一页，虚拟地址上的每一页可以对应物理地址上相同大小的一个页框，

优点：这样虚拟地址上连续的页面所对应的物理页面不需要连续，只需要保证页面之间对应即可，减小了连续区间的大小，这样每次换入换出的时候可以以页面大小为单位，而不用像分段那样一次换出一整个段，提高的换入换出的效率；
另一方面连续的地址空间是一个页面大小，不会造成内存碎片问题

寻址方式：
分页机制下，虚拟地址由两部分构成：页号和页内偏移
页号作为页表的索引，页表项中记录了页面对应的物理页的基地址，通过基地址和页内偏移就确定了物理地址

#### 引入多级页表
如果每个进程只有一个页表，每个页表记录该进程整个虚拟地址空间跟物理地址空间的映射，页表将占用较多内存



## 常见问题：什么是虚拟内存？
虚拟内存也就是虚拟地址空间，它是物理地址空间的抽象，是内核通过数据结构描述出来的，
进程中的地址都通过虚拟地址来描述，然后通过MMU和页表找到相应的物理地址；
进程的虚拟地址空间虽然是一样的，但是通过将其虚拟页面与不同的物理页建立映射关系，就实现了进程间物理地址的隔离；
另一个好处是：因为进程运行时操作的首先是得到虚拟地址，然后再经过MMU和页表找到相应的物理地址，所以对于没有被访问到的地址，可以先不建立虚拟地址和物理地址之间的映射，
所以我有限大小的内存，可以分给多个进程，一部分页面跟一个进程建立映射，另一部分跟其它进程建立映射；
因为程序运行都有这个时间、空间局部性，所以在运行时间内，只有一小部分地址空间被访问到，我可以对访问位置的页面建立映射，随着程序的运行，当出现缺页中断时，再通过页面置换算法选择合适的物理页面建立映射关系

## CPU调度算法
1. 先来先服务调度：每次从就绪队列中选择最先进入队列的就绪的进程
2. 短作业优先调度：选择运行时间最短的就绪进程运行，可能会造成运行时间长的进程饿死
3. 高响应比优先调度：通过(等待时间+服务时间)/服务时间   得到响应比，选择响应比最高的就绪进程运行
4. 时间片轮转调度：每个进程分配一个时间片，如果时间片用完，进程还没有结束，就将当前进程调度出去，然后选择下一个进程运行
5. 优先级调度算法：每个进程分配一个优先级（优先级可以静态分配：比如在进程创建时分配，之后运行期间不会更改，也可以动态分配：运行期间根据运行情况动态调整，比如如果等待时间过长，就提高进程的优先级）
                  每次选择优先级最高的进程运行，又可以分为抢占式和不可抢占式，抢占式是指：如果在进程运行期间，有更改优先级的进程就绪，这个更高优先级进程就可以抢占CPU的控制权直接运行；
                  如果是不可抢占式，则是等待当前正在运行的进程运行完（比如结束、阻塞或者时间片用完然后被调度出去），然后调度这个高优先级进程运行
6. 多级反馈队列调度：维护多个就绪队列，每个队列一个优先级，优先级由高到低，当有进程就绪时，将其放入最高优先级的队列中，调度时，从最高优先级开始取进程执行，如果最高优先级中没有进程，就向下一级队列查找，直至找到就绪进程


## 页面置换算法
1. 先进先出页面置换，先被换入使用的页面先被换出
2. LRU算法，最近最少使用页面置换算法，选择最近一段时间最久没有被使用的页面进行置换
3. 时钟调度算法：把所有页面保存在一个环形链表中，一个指针指向最老的页面，当发生缺页中断时，算法首先检查指针所指向的页面：
                如果它的访问位为0，就选择该页面，将其中数据换出到外存，然后作为新页面给发生缺页中断的进程使用，如果它的访问位是1，就将该位置为0，然后将指针后移，直到找到一个访问位是0的页面
4. 最不常用算法：为，每个页面维护一个访问计数器，每当一个页面被访问时，这个页面的访问计数器就加1，当进行页面置换时，选择访问次数最少的那个页面：


## 磁盘调度算法
1. 先来先服务：先到达的磁盘请求先被服务
2. 最短寻道时间优先：优先选择从当前磁头位置所需寻道时间最短的请求
3. 循环扫描算法：磁头先在一个方向上移动，依次处理这个方向上的请求，然后再转向另一方向继续处理


## 操作系统应该具有哪些内容？
1. 虚拟内存管理：
   (1)引入虚拟内存;
   (2)虚拟内存再如何分段、分页，
   (3)页表如何组织：每一段有一份该段虚拟地址空间的页表还是一整个页表，分几级页表
2. 进程线程管理
   (1)进程线程如何表示，有哪些成员
   (2)怎么进行进程线程间的通信与同步
   (3)怎么设计锁
   (4)死锁是怎么回事？怎么解决？
3. 调度算法
   (1)CPU(进程)调度
   (2)页面置换
   (3)磁盘调度
4. 文件系统
   (1)在内存中使用什么结构表示文件、管理文件
5. 磁盘等硬件的管理
   设备驱动程序也是操作系统的一部分，操作系统的内核代码通过调用设备驱动程序的接口来向设备控制器发出指令，以此控制对设备的读写
6. 网络系统：协议栈，如何收发数据包：收发的时候怎么添加头部、去除头部，对于IP的分片如何进行以及收到后如何对分片合并恢复原始的报文等等



