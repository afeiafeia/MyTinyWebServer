
<http://www.manongjc.com/detail/25-ocwlrnqofgamdki.html>
## linux为什么将中断分为上半部和下半部
linux中设备与内核通过中断来通信，当设备就绪的时候，会生成电信号，送入中断控制器的输入引脚，中断控制器收到电信号后，会向处理器发送一个电信号，
当处理器收到后，就会指向相应的中断服务例程来进行处理
中断处理程序一般是设备驱动程序的一部分，一方面它通知发出信号的硬件设备，信号已经被接受，另一方面便是进行中断处理，例如拷贝数据到内存，并进行后续处理等

但是，这种中断是随时可能发生的，而且这种中断会屏蔽其它设备产生的中断，导致中断处理函数执行期间，其余中断信号不能被处理，这就会造成效率以及性能的问题，
为了保证这种中断能够执行完成，一般把中断处理分为上半部和下半部
(1)上半部是硬件中断，通过硬件产生，但是只执行重要紧急且能快速完成的操作
(2)下半部执行后续比较耗时的操作


## 中断机制的实现：
每个能发出中断请求的硬件设备控制器都有一条名为IRQ的输出线（每条有一个编号，连在相应编号的引脚上），所有的IRQ线都与一个可编程的中断控制器的硬件电路的输入引脚相连，
中断控制器监视所有的IRQ线（中断控制器可以选择性的忽略某个引脚上的中断），当有信号出现时（如果多个信号出现，选择编号小的引脚上的信号进行处理），会把接受到的信号转成向量，发送给CPU；

当中断控制器收到硬件产生的中断后，如果没有忽略这个中断，就会立即停止正在运行的程序，然后关闭中断系统（忽略所有引脚上的中断，也可能不关闭整个中断系统而只屏蔽一部分中断线或者仅仅屏蔽当前这类中断的中断线），
*屏蔽中断的目的：中断处理函数是一个执行流，不是进程或者线程，如果在一个执行完之前又被再次调用，会造成数据的覆盖*
转而执行相应中断的中断处理函数，执行完再恢复原始执行流程
这种中断处理函数是内核的一个执行流，不属于进程，因此不会被阻塞，直至执行完成后退出，退出前恢复屏蔽的中断

linux中，对于下半部的实现有多种方式：
(1)软中断：linux中的软中断都是在专门的内核线程（ksoftirqd）中进行的，它在系统启动的时候被创建，一般是创建多个该线程，创建之后就执行一个循环函数，不断检查有没有软中断需要处理，有的话判断是哪种软中断，然后调用相应的中断处理函数
(2)tasklet：
(3)工作队列：

 